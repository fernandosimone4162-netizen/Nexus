<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nexus</title>
<style>
body{font-family:Arial;background:#111;color:#eee;padding:20px}
h1,h2{color:#4CAF50}
section{border:1px solid #333;padding:15px;margin-bottom:20px;border-radius:8px}
input,select,button{margin:5px;padding:6px}
button{cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #333;padding:6px;text-align:center}
.total{font-size:18px;color:#0f0}
</style>
</head>
<body>

<h1>Nexus</h1>

<section>
<h2>Venda - Múltiplos Itens</h2>

<input id="itemNome" placeholder="Produto">
<input id="itemQtd" type="number" step="0.01" placeholder="Quantidade">
<select id="itemUnidade">
<option>unidade</option>
<option>kg</option>
<option>litro</option>
</select>
<input id="itemPreco" type="number" step="0.01" placeholder="Preço unitário">
<button onclick="addItem()">Adicionar item</button>

<table>
<thead>
<tr><th>Produto</th><th>Qtd</th><th>Unid</th><th>Preço</th><th>Total</th></tr>
</thead>
<tbody id="itens"></tbody>
</table>

<h3>Ajustes</h3>
<input id="ajusteValor" type="number" step="0.01" placeholder="Ajuste R$ (+/-)">
<input id="ajustePorc" type="number" step="0.01" placeholder="Ajuste % valor">
<input id="ajusteVolume" type="number" step="0.01" placeholder="Ajuste % volume">

<p class="total">Total Venda: R$ <span id="totalVenda">0.00</span></p>
<button onclick="finalizarVenda()">Finalizar Venda</button>
</section>

<section>
<h2>Compra / Fornecedor</h2>
<input id="compraNome" placeholder="Produto">
<input id="compraQtd" type="number" step="0.01" placeholder="Quantidade">
<input id="compraPreco" type="number" step="0.01" placeholder="Preço unitário">
<button onclick="addCompra()">Registrar Compra</button>
</section>

<section>
<h2>Histórico de Vendas</h2>
<div id="histVendas"></div>
</section>

<section>
<h2>Histórico de Compras</h2>
<div id="histCompras"></div>
</section>

<section>
<h2>Resumo Mensal</h2>
<p>Total Vendido no Mês: R$ <span id="mesVendas">0.00</span></p>
<p>Total Gasto no Mês: R$ <span id="mesCompras">0.00</span></p>
</section>

<script>
let itensVenda=[];
let vendas=JSON.parse(localStorage.getItem("vendas")||"[]");
let compras=JSON.parse(localStorage.getItem("compras")||"[]");

function addItem(){
let nome=itemNome.value;
let qtd=parseFloat(itemQtd.value);
let un=itemUnidade.value;
let preco=parseFloat(itemPreco.value);
if(!nome||!qtd||!preco)return;
itensVenda.push({nome,qtd,un,preco});
renderItens();
}

function renderItens(){
itens.innerHTML="";
let total=0;
itensVenda.forEach(i=>{
let subtotal=i.qtd*i.preco;
total+=subtotal;
itens.innerHTML+=`<tr>
<td>${i.nome}</td>
<td>${i.qtd}</td>
<td>${i.un}</td>
<td>${i.preco.toFixed(2)}</td>
<td>${subtotal.toFixed(2)}</td>
</tr>`;
});

let ajusteV=parseFloat(ajusteValor.value)||0;
let ajusteP=parseFloat(ajustePorc.value)||0;
let ajusteVol=parseFloat(ajusteVolume.value)||0;

let volumeExtra=0;
if(ajusteVol>0){
itensVenda.forEach(i=>{
volumeExtra+=i.qtd*(ajusteVol/100);
});
}

total += ajusteV;
total += total*(ajusteP/100);

totalVenda.innerText=total.toFixed(2);
}

["ajusteValor","ajustePorc","ajusteVolume"].forEach(id=>{
document.getElementById(id).oninput=renderItens;
});

function finalizarVenda(){
let total=parseFloat(totalVenda.innerText);
let data=new Date();
vendas.push({data:data.toISOString(),itens:itensVenda,total});
localStorage.setItem("vendas",JSON.stringify(vendas));
itensVenda=[];
renderItens();
renderHist();
}

function addCompra(){
let nome=compraNome.value;
let qtd=parseFloat(compraQtd.value);
let preco=parseFloat(compraPreco.value);
if(!nome||!qtd||!preco)return;
let data=new Date();
compras.push({data:data.toISOString(),nome,qtd,preco,total:qtd*preco});
localStorage.setItem("compras",JSON.stringify(compras));
renderHist();
}

function renderHist(){
histVendas.innerHTML="";
histCompras.innerHTML="";
let mes=new Date().getMonth();
let ano=new Date().getFullYear();
let tv=0,tc=0;

vendas.forEach(v=>{
let d=new Date(v.data);
histVendas.innerHTML+=`${d.toLocaleString()} - R$ ${v.total.toFixed(2)}<br>`;
if(d.getMonth()==mes&&d.getFullYear()==ano)tv+=v.total;
});

compras.forEach(c=>{
let d=new Date(c.data);
histCompras.innerHTML+=`${d.toLocaleString()} - ${c.nome} - R$ ${c.total.toFixed(2)}<br>`;
if(d.getMonth()==mes&&d.getFullYear()==ano)tc+=c.total;
});

mesVendas.innerText=tv.toFixed(2);
mesCompras.innerText=tc.toFixed(2);
}

renderHist();
</script>

</body>
</html>
